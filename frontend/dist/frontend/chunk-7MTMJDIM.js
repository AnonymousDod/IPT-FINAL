import{a as ue}from"./chunk-HNSN67LX.js";import{b as N}from"./chunk-5RCUSW7M.js";import{a as A,b as pe}from"./chunk-7FSPOTPR.js";import{$ as W,A as r,B as g,Ba as ae,Ca as me,E as I,F as f,Fa as M,G as c,H as L,Ha as T,Ia as de,K as l,Ka as F,L as q,M as E,N as D,O as C,P as B,S as $,T as Q,U as G,X as H,Y as w,Z as R,ca as z,ea as J,k as y,ka as K,m as P,ma as X,n as b,na as Y,o as U,oa as Z,p as S,pa as ee,q as x,qa as te,r as _,ra as ie,s as v,u as o,ua as ne,v as h,va as re,wa as se,x as d,xa as oe,y as a,ya as le,z as n}from"./chunk-AFLXQZBF.js";import{a as O}from"./chunk-2XJVAMHT.js";var k=(()=>{class t{constructor(e){this.http=e,this.apiUrl=`${A.apiUrl}/requests`}getAll(){return this.http.get(this.apiUrl)}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}getByEmployeeId(e){return this.http.get(`${this.apiUrl}/employee/${e}`)}create(e){return this.http.post(this.apiUrl,e)}update(e,i){return this.http.put(`${this.apiUrl}/${e}`,i)}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}getEmployees(){return this.http.get(`${A.apiUrl}/employees`)}getWorkflows(){return this.http.get(`${A.apiUrl}/workflows`)}static{this.\u0275fac=function(i){return new(i||t)(U(J))}}static{this.\u0275prov=P({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Ie(t,m){t&1&&(n(0,"span"),l(1,"Requests"),r())}function qe(t,m){if(t&1&&(n(0,"span"),l(1),r()),t&2){let e=c();o(1),E("Requests for Employee: ",e.employeeName,"")}}function Ee(t,m){if(t&1){let e=I();n(0,"button",12),f("click",function(){_(e);let s=c();return v(s.backToEmployees())}),g(1,"i",13),l(2," Back to Employees "),r()}}function be(t,m){t&1&&(n(0,"div",14),g(1,"span",15),r())}function Se(t,m){t&1&&(n(0,"span"),l(1,'No requests found. Click "Add Request" to create your first request.'),r())}function xe(t,m){t&1&&(n(0,"span"),l(1,"No requests found for this employee."),r())}function Ce(t,m){if(t&1&&(n(0,"div",16),d(1,Se,2,0,"span",3),d(2,xe,2,0,"span",3),r()),t&2){let e=c();o(1),a("ngIf",!e.isSingleEmployeeView),o(1),a("ngIf",e.isSingleEmployeeView)}}function we(t,m){t&1&&(n(0,"th"),l(1,"Employee ID"),r())}function Re(t,m){if(t&1&&(n(0,"span"),l(1),r()),t&2){let e=c(2).$implicit;o(1),C(" ",(e.Employee==null?null:e.Employee.employeeId)||"ID Not Set"," - ",(e.Employee==null||e.Employee.user==null?null:e.Employee.user.firstName)||""," ",(e.Employee==null||e.Employee.user==null?null:e.Employee.user.lastName)||""," ")}}function Me(t,m){if(t&1&&(n(0,"span"),l(1),r()),t&2){let e=c(2).$implicit;o(1),E(" ",e.employeeId," ")}}function Te(t,m){if(t&1&&(n(0,"td"),d(1,Re,2,3,"span",3),d(2,Me,2,1,"span",3),r()),t&2){let e=c().$implicit;o(1),a("ngIf",e.Employee),o(1),a("ngIf",!e.Employee)}}function Ae(t,m){if(t&1&&(n(0,"li")(1,"span",27),l(2),r()()),t&2){let e=m.$implicit;o(2),D("",e.name," \xD7 ",e.quantity,"")}}function Ne(t,m){t&1&&(n(0,"li")(1,"span",28),l(2,"No items"),r()())}var Ve=function(t,m,e){return{"bg-info":t,"bg-warning":m,"bg-secondary":e}},ke=function(){return[]},Le=function(t,m,e){return{"bg-warning":t,"bg-success":m,"bg-danger":e}};function $e(t,m){if(t&1){let e=I();n(0,"tr")(1,"td")(2,"span",20),l(3),Q(4,"titlecase"),r()(),d(5,Te,3,2,"td",3),n(6,"td")(7,"ul",21),d(8,Ae,3,2,"li",19),d(9,Ne,3,0,"li",3),r()(),n(10,"td")(11,"span",20),l(12),r()(),n(13,"td")(14,"div",22)(15,"button",23),f("click",function(){let p=_(e).$implicit,u=c(2);return v(u.edit(p.id))}),g(16,"i",24),l(17," Edit "),r(),n(18,"button",25),f("click",function(){let p=_(e).$implicit,u=c(2);return v(u.delete(p.id))}),g(19,"i",26),l(20," Delete "),r()()()()}if(t&2){let e=m.$implicit,i=c(2);o(2),a("ngClass",$(9,Ve,e.type==="leave",e.type==="expense",e.type==="transfer")),o(1),q(G(4,7,e.type)),o(2),a("ngIf",!i.isSingleEmployeeView),o(3),a("ngForOf",e.RequestItems||B(13,ke)),o(1),a("ngIf",!e.RequestItems||e.RequestItems.length===0),o(2),a("ngClass",$(14,Le,e.status==="Pending",e.status==="Approved",e.status==="Rejected")),o(1),q(e.status)}}function Fe(t,m){if(t&1&&(n(0,"div",17)(1,"table",18)(2,"thead")(3,"tr")(4,"th"),l(5,"Type"),r(),d(6,we,2,0,"th",3),n(7,"th"),l(8,"Items"),r(),n(9,"th"),l(10,"Status"),r(),n(11,"th"),l(12,"Actions"),r()()(),n(13,"tbody"),d(14,$e,21,18,"tr",19),r()()()),t&2){let e=c();o(6),a("ngIf",!e.isSingleEmployeeView),o(8),a("ngForOf",e.requests)}}var fe=(()=>{class t{constructor(e,i,s,p,u,ge){this.requestService=e,this.accountService=i,this.alertService=s,this.employeeService=p,this.route=u,this.router=ge,this.requests=[],this.loading=!1,this.employeeId=null,this.employeeName="",this.isSingleEmployeeView=!1}ngOnInit(){this.route.queryParams.subscribe(e=>{e.employeeId?(this.employeeId=parseInt(e.employeeId,10),this.isSingleEmployeeView=!0,this.loadEmployeeRequests(this.employeeId),this.loadEmployeeName(this.employeeId)):(this.isSingleEmployeeView=!1,this.loadAllRequests())})}loadAllRequests(){this.loading=!0,this.requestService.getAll().pipe(y()).subscribe({next:e=>{this.requests=e,this.loading=!1},error:e=>{this.alertService.error("Error loading requests: "+e),this.loading=!1}})}loadEmployeeRequests(e){this.loading=!0,this.requestService.getByEmployeeId(e).pipe(y()).subscribe({next:i=>{this.requests=i,this.loading=!1},error:i=>{this.alertService.error("Error loading employee requests: "+i),this.loading=!1}})}loadEmployeeName(e){this.employeeService.getById(e).pipe(y()).subscribe({next:i=>{i&&(this.employeeName=`${i.employeeId} - ${i.user?.firstName||""} ${i.user?.lastName||""}`)}})}account(){return this.accountService.accountValue}edit(e){this.router.navigate(["/requests/edit",e])}delete(e){confirm("Are you sure you want to delete this request?")&&(this.loading=!0,this.requestService.delete(e).pipe(y()).subscribe({next:()=>{this.alertService.success("Request deleted successfully"),this.requests=this.requests.filter(i=>i.id!==e),this.loading=!1},error:i=>{this.alertService.error("Error deleting request: "+i),this.loading=!1}}))}add(){this.employeeId?this.router.navigate(["/requests/add"],{queryParams:{employeeId:this.employeeId}}):this.router.navigate(["/requests/add"])}backToEmployees(){this.router.navigate(["/employees"])}static{this.\u0275fac=function(i){return new(i||t)(h(k),h(pe),h(N),h(ue),h(M),h(T))}}static{this.\u0275cmp=S({type:t,selectors:[["app-request-list"]],decls:15,vars:6,consts:[[1,"card"],[1,"card-header"],[1,"d-flex","justify-content-between","align-items-center"],[4,"ngIf"],["class","btn btn-outline-secondary",3,"click",4,"ngIf"],[1,"card-body"],["class","text-center p-3",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"text-end","mt-3"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-plus"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fa","fa-arrow-left"],[1,"text-center","p-3"],[1,"spinner-border","spinner-border-lg"],[1,"alert","alert-info"],[1,"table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"badge",3,"ngClass"],[1,"list-unstyled","mb-0"],[1,"btn-group"],[1,"btn","btn-sm","btn-primary","me-1",3,"click"],[1,"fa","fa-edit"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fa","fa-trash"],[1,"badge","bg-light","text-dark"],[1,"text-muted"]],template:function(i,s){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),d(4,Ie,2,0,"span",3),d(5,qe,2,1,"span",3),r(),d(6,Ee,3,0,"button",4),r()(),n(7,"div",5),d(8,be,2,0,"div",6),d(9,Ce,3,2,"div",7),d(10,Fe,15,2,"div",8),n(11,"div",9)(12,"button",10),f("click",function(){return s.add()}),g(13,"i",11),l(14," Add Request "),r()()()()),i&2&&(o(4),a("ngIf",!s.isSingleEmployeeView),o(1),a("ngIf",s.isSingleEmployeeView),o(1),a("ngIf",s.isSingleEmployeeView),o(2),a("ngIf",s.loading),o(1),a("ngIf",!s.loading&&(!s.requests||s.requests.length===0)),o(1),a("ngIf",!s.loading&&s.requests&&s.requests.length>0))},dependencies:[H,w,R,W],encapsulation:2})}}return t})();function je(t,m){if(t&1&&(n(0,"div",26),l(1),r()),t&2){let e=c();o(1),q(e.errorMessage)}}function Oe(t,m){if(t&1&&(n(0,"option",27),l(1),r()),t&2){let e=m.$implicit;a("ngValue",e.id),o(1),C(" ",e.employeeId||"ID Not Set"," - ",(e.user==null?null:e.user.firstName)||""," ",(e.user==null?null:e.user.lastName)||""," ")}}function Pe(t,m){t&1&&(n(0,"small",28),l(1,"Loading employees..."),r())}function Ue(t,m){if(t&1){let e=I();n(0,"div",29)(1,"div",30)(2,"input",31),f("ngModelChange",function(s){let u=_(e).$implicit;return v(u.name=s)}),r()(),n(3,"div",32)(4,"input",33),f("ngModelChange",function(s){let u=_(e).$implicit;return v(u.quantity=s)}),r()(),n(5,"div",32)(6,"button",34),f("click",function(){let p=_(e).index,u=c();return v(u.removeItem(p))}),g(7,"i",35),l(8," Remove "),r()()()}if(t&2){let e=m.$implicit,i=m.index;o(2),L("name","itemName",i,""),a("ngModel",e.name),o(2),L("name","itemQuantity",i,""),a("ngModel",e.quantity)}}function De(t,m){t&1&&(n(0,"div",36),l(1," At least one item is required. "),r())}function Be(t,m){t&1&&g(0,"span",37)}var j=(()=>{class t{constructor(e,i,s,p){this.route=e,this.router=i,this.requestService=s,this.alertService=p,this.request={type:"",employeeId:"",status:"Pending",items:[{name:"",quantity:1}]},this.employees=[],this.workflows=[],this.loading=!1,this.submitted=!1,this.errorMessage="",this.preselectedEmployeeId=null}ngOnInit(){this.id=this.route.snapshot.params.id,this.route.queryParams.subscribe(e=>{e.employeeId&&(this.preselectedEmployeeId=parseInt(e.employeeId,10),this.request.employeeId=this.preselectedEmployeeId)}),this.requestService.getEmployees().subscribe({next:e=>{this.employees=e,this.employees.length===0&&this.alertService.warn("No employees found. Please create employees first.")},error:e=>{this.alertService.error("Error loading employees: "+e)}}),this.id&&(this.loading=!0,this.requestService.getById(this.id).pipe(y()).subscribe({next:e=>{this.request=e,e.RequestItems&&e.RequestItems.length>0?this.request.items=e.RequestItems:this.request.items||(this.request.items=[{name:"",quantity:1}]),this.request.employeeId&&typeof this.request.employeeId=="string"&&(this.request.employeeId=parseInt(this.request.employeeId,10)),this.loading=!1},error:e=>{this.alertService.error("Error loading request: "+e),this.router.navigate(["../"],{relativeTo:this.route}),this.loading=!1}}))}addItem(){this.request.items.push({name:"",quantity:1})}removeItem(e){this.request.items.length>1?this.request.items.splice(e,1):this.alertService.error("At least one item is required")}onSubmit(){if(this.submitted=!0,this.loading=!0,this.errorMessage="",!this.request.type||!this.request.employeeId){this.errorMessage="Please fill all required fields",this.loading=!1;return}if(this.request.items.some(i=>!i.name.trim())){this.errorMessage="All items must have a name",this.loading=!1;return}if(this.request.items.some(i=>!i.quantity||i.quantity<1)){this.errorMessage="All items must have a quantity greater than 0",this.loading=!1;return}this.id||(this.request.status="Pending");let e=O({},this.request);e.employeeId&&typeof e.employeeId=="string"&&(e.employeeId=parseInt(e.employeeId,10)),this.id?this.updateRequest(e):this.createRequest(e)}createRequest(e){this.requestService.create(e).pipe(y()).subscribe({next:()=>{this.alertService.success("Request created successfully",{keepAfterRouteChange:!0}),this.preselectedEmployeeId?this.router.navigate(["/requests"],{queryParams:{employeeId:this.preselectedEmployeeId}}):this.router.navigate(["../"],{relativeTo:this.route})},error:i=>{this.errorMessage=i.error?.message||"An error occurred while creating the request",this.alertService.error(this.errorMessage),this.loading=!1}})}updateRequest(e){this.requestService.update(this.id,e).pipe(y()).subscribe({next:()=>{this.alertService.success("Update successful",{keepAfterRouteChange:!0}),this.preselectedEmployeeId?this.router.navigate(["/requests"],{queryParams:{employeeId:this.preselectedEmployeeId}}):this.router.navigate(["../"],{relativeTo:this.route})},error:i=>{this.errorMessage=i.error?.message||"An error occurred while updating the request",this.alertService.error(this.errorMessage),this.loading=!1}})}cancel(){this.preselectedEmployeeId?this.router.navigate(["/requests"],{queryParams:{employeeId:this.preselectedEmployeeId}}):this.router.navigate(["../"],{relativeTo:this.route})}static{this.\u0275fac=function(i){return new(i||t)(h(M),h(T),h(k),h(N))}}static{this.\u0275cmp=S({type:t,selectors:[["ng-component"]],decls:43,vars:11,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],["class","alert alert-danger",4,"ngIf"],[3,"ngSubmit"],[1,"form-group","mb-3"],["for","type"],["name","type","required","",1,"form-select",3,"ngModel","ngModelChange"],["value",""],["value","leave"],["value","expense"],["value","transfer"],["for","employeeId"],["name","employeeId","required","",1,"form-select",3,"ngModel","disabled","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"card","mb-2"],[1,"card-body","p-2"],["class","row mb-2 align-items-center",4,"ngFor","ngForOf"],["class","alert alert-warning",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fa","fa-plus"],[1,"form-group","mt-4"],[1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],["routerLink","../",1,"btn","btn-link"],[1,"alert","alert-danger"],[3,"ngValue"],[1,"text-muted"],[1,"row","mb-2","align-items-center"],[1,"col-md-6"],["type","text","placeholder","Item name","required","",1,"form-control",3,"ngModel","name","ngModelChange"],[1,"col-md-3"],["type","number","placeholder","Quantity","min","1","required","",1,"form-control",3,"ngModel","name","ngModelChange"],["type","button",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fa","fa-times"],[1,"alert","alert-warning"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(i,s){i&1&&(n(0,"div",0)(1,"div",1)(2,"h3"),l(3),r()(),n(4,"div",2),d(5,je,2,1,"div",3),n(6,"form",4),f("ngSubmit",function(){return s.onSubmit()}),n(7,"div",5)(8,"label",6),l(9,"Request Type"),r(),n(10,"select",7),f("ngModelChange",function(u){return s.request.type=u}),n(11,"option",8),l(12,"-- Select Request Type --"),r(),n(13,"option",9),l(14,"Leave Request"),r(),n(15,"option",10),l(16,"Expense Request"),r(),n(17,"option",11),l(18,"Transfer Request"),r()()(),n(19,"div",5)(20,"label",12),l(21,"Employee ID"),r(),n(22,"select",13),f("ngModelChange",function(u){return s.request.employeeId=u}),n(23,"option",8),l(24,"-- Select Employee --"),r(),d(25,Oe,2,4,"option",14),r(),d(26,Pe,2,0,"small",15),r(),n(27,"div",5)(28,"label"),l(29,"Request Items"),r(),n(30,"div",16)(31,"div",17),d(32,Ue,9,4,"div",18),d(33,De,2,0,"div",19),r()(),n(34,"button",20),f("click",function(){return s.addItem()}),g(35,"i",21),l(36," Add Item "),r()(),n(37,"div",22)(38,"button",23),d(39,Be,1,0,"span",24),l(40," Save Request "),r(),n(41,"a",25),l(42,"Cancel"),r()()()()()),i&2&&(o(3),E("",s.id?"Edit":"Add"," Request"),o(2),a("ngIf",s.errorMessage),o(5),a("ngModel",s.request.type),o(12),a("ngModel",s.request.employeeId)("disabled",!!s.id),o(3),a("ngForOf",s.employees),o(1),a("ngIf",s.employees.length===0),o(6),a("ngForOf",s.request.items),o(1),a("ngIf",s.request.items.length===0),o(5),a("disabled",s.loading),o(1),a("ngIf",s.loading))},dependencies:[w,R,te,re,se,K,ie,ne,X,Y,le,oe,ee,Z,de],encapsulation:2})}}return t})();var Qe=[{path:"",component:fe},{path:"add",component:j},{path:"edit/:id",component:j}],he=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=b({imports:[F.forChild(Qe),F]})}}return t})();var ut=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=b({imports:[z,me,ae,he]})}}return t})();export{ut as RequestsModule};
